Status: idea

# Templating for blockchain content

> Let's get a common way of engaging templating engines for content on the blockchain.

This document describes the protocol "B://emplate" (pronounced bemplate). Please share [inputs and comments](https://github.com/bico-media/bemplate/issues).

## Introduction

Templating is a common way of merging data with structure. Different templating engines have different syntax and options for logic but a shared feature is that they have source data in a structured way and a template for using those data. 
The B://emplate protocol describes a common way of using templating engines for data stored on the blockchain. Please note that no specific templating engine is suggested or recommended. 

In the following, we will refer to `main data object` to refer to the data context in which a template engine will run. 

## Overview

### Version 1

_Apoint data and template_

The `1GQuCczfJrvQqK9Vr64BQ8zJ9b7fiXq6Fg` bitcom namespace shall have 3 arguments and be placed on 1st position after an `OP_RETURN` code. 
1. A string named `engine name`
2. A transaction ID called `template` 
3. A transaction ID called `data

If you provide content from the blockchain you are compatible with the B://Bemplate protocol v1 if you:


- Let clients who request content from a transaction with the `1GQuCczfJrvQqK9Vr64BQ8zJ9b7fiXq6Fg` bitcom namespace at the first position after an `OP_RETURN` code be presented with the content generated by running the templating engine `engine` with content the `template` and `data` transactions. 

### Version 2

_Apoint data_

The `1NHGwK36T4BUVxrCs3GVf5Qrax3Sf2z2Bm` bitcom namespace shall have 2 arguments and be position anywhere after an `OP_RETURN` code. 
1. A string named `engine`
3. A transaction ID called `data`

If you provide content from the blockchain you are compatible with the B://Bemplate protocol v2 if you:


- Are compatible with B://Bemplate protocol v1

- Let clients who request content from a transaction with the `1NHGwK36T4BUVxrCs3GVf5Qrax3Sf2z2Bm` bitcom namespace be presented with the content generated by running the templating engine `engine` with `data` as data input and content from the current engine as template. 


### Version 3

_Apoint template_

The `15SyJjP3VTaVWNEces7syqYeSjTF2kU3mq` bitcom namespace shall have 3 arguments and be position anywhere after an `OP_RETURN` code. 
1. A string named `engine name`
3. A transaction ID called `template`

If you provide content from the blockchain you are compatible with the B://Bemplate protocol v3 if you:


- Are compatible with B://Bemplate protocol v2

- Let clients who request content from a transaction with the `15SyJjP3VTaVWNEces7syqYeSjTF2kU3mq` bitcom namespace be presented with the content generated by running the templating engine `engine` with content from `template` as template and data as a [HJSON](http://hjson.org) parsed version of the current content. 




### Version 4

_Pull data from template_

If you provide content from the blockchain you are compatible with the B://Bemplate protocol v4 if you:


- Are compatible with B://Bemplate protocol v3

- Make sure content containing the key text `{{abc=B://[TX]}}` 
  - will have the key text removed 
  - a `main data object` populated with a property named `abc` containing 
    - the structured data from the target TX if data is valid [HJSON](http://hjson.org/) 
    - if not valid HJSON a string containing the full content 
  - Rerun until no more key texts exist in the content.

- Make sure content containing the key text `{{zyx=B://}}` 
  - Will have the key text removed 
  - The templating engine `zyx` will be initiated with the `main data object` as input and the current content as template. 
  - Rerun until no more key texts exist in the content.

Example:

The following content 

```
{{liquid=B://}}
{{onStock=B://3534afc24bfb8395d9452b3a384235591b56065c674e602a277b52dd0638e0c2}}
<ul id="stuff">
  {% for product in onStock.products %}
    <li><b>{{ product.name }}</b> Only {{ product.price | price }}.
  {% endfor %}
</ul>
```

Will produce

```
<ul id="stuff">
    <li><b>Spoon</b> Only 2.99.
    <li><b>Knife</b> Only 4.5.
    <li><b>Fork</b> Only 5.15.
</ul>
```


This is a draft and should be expanded into its own document describing edge cases and error handling. 



### Version 5

_Combine templating with injected content_

If you provide content from the blockchain you are compatible with the B://emplate protocol v5 if you:

- Are compatible with B://Bemplate protocol v4

- Are compatible with [B://andlebars protocol](http://bandlebars.bico.media/) v1 or higher

- Run the B://andlebars protocol on all data from a target TX before adding to the `main data object`

- Run the B://andlebars protocol full content before any templating engine and after all templating engine.

This is a draft and should be expanded into its own document.


### Version 6

_Static template with dynamic data_


If you provide content from the blockchain you are compatible with the B://emplate protocol v6 if you:

- Are compatible with B://Bemplate protocol v5

- Are compatible with [B://ynamic protocol](http://bynamic.bico.media/) v1 or higher

- Handle tx32 referenced transactions according to the B://ynamic protocol.


## Template engine names

The following templating engines must be identified by its `engine name`. The engine names are case insensitive.

|Template engine|Engine name|Example for v4|
|---------------|----------------|---------------
|[Liquid](https://shopify.github.io/liquid/)| `liquid`| `{{liquid=B://}}`
|[Pug](https://pugjs.org)| `pug`| `{{pug=B://}}`
|[Handlebars](https://handlebarsjs.com/)| `handlebars`| `{{handlebars=B://}}`
|[Mustache](https://mustache.github.io/)| `mystache`| `{{mustache=B://}}`


Please notet that this list is only a start. Please add more are other templating engines get implemented. 


## Implementations

|Template engine|Supported on blockchain gateway|
|---------------|-------------------------------
|[Liquid](https://shopify.github.io/liquid/)| No known implementations
|[Pug](https://pugjs.org)| No known implementations
|[Handlebars](https://handlebarsjs.com/)| No known implementations 
|[Mustache](https://mustache.github.io/)| No known implementations


----

Please share [inputs and comments](https://github.com/bico-media/bemplate/issues).
